                                                   Л. Г. Б у н и ч

     Унифицированный комплект драйверов клавиатуры и экрана
     ------------------------------------------------------
                  Редакция:           UniKbd 4.1   (январь 1992)
                                      UniScr 2.5a  (январь 1992)


  ------------------- С О Д Е Р Ж А Н И Е -----------------------

  В В Е Д Е Н И Е
  П р о г р а м м а   U N I K B D
  П р о г р а м м а   U N I S C R
  П р и л о ж е н и е   1. План клавиатуры
  П р и л о ж е н и е   2. Определение нестандартных клавиш
    Т а б л и ц а   1.  Скэн-коды клавиш
  П р и л о ж е н и е   3. Коды цветов экрана
  П р и л о ж е н и е   4. Протокол изменений последних редакций



                         В В Е Д Е Н И Е

   Предлагаемая система UNI  содержит драйверы для работы с кирил-
лицей и другими национальными алфавитами.

   В состав системы входят:

      - драйвер клавиатуры         (UNIKBD.COM);
      - драйвер экрана EGA или VGA (UNISCR.COM);
      - примеры планов клавиатуры  (UNIKALT.STD, UNIKALT.REV);
      - примеры шрифтов экрана     (файлы *.F8, *.F14, *.F16).

   Далее для определенности мы будем говорить  о русском алфавите,
хотя не представляет никакого труда описать, например, украинскую,
грузинскую, армянскую, греческую и др. клавиатуры,  а также экран-
ные шрифты для них.  Соответственно стандартный и национальный ре-
гистры букв далее обозначаются ЛАТ и РУС. Для не-русских алфавитов
несложно сгенерировать чисто англоязычные или национальные вариан-
ты UNI-драйверов.

   Система обладает  следующими преимуществами  перед аналогичными
(из числа известных автору).

   1. Ошибки, характерные для многих других драйверов,  отсутству-
ют.  Например, UNIKBD правильно обрабатывает "серые" клавиши, рус-
ское "р" и пр.

   UNISCR содержат шрифты для вывода в текстовых  (25,  43  или 50
строк) и в графических режимах (320 или 640  точек). Предусмотрены
некоторые меры по работе драйверов на ЭВМ с не вполне совместимыми
BIOS или картами EGA/VGA.

   2. Для перехода на русский регистр и обратно пользователь может
определить любое удобное для него сочетание клавиш. При этом можно
(и даже рекомендуется) определить не одно, а два сочетания клавиш:
одно для установки русского регистра, другое - латинского. Это из-
бавляет  от необходимости  постоянно помнить,  в каком регистре мы
сейчас работаем, и соответственно снижает число ошибок. Разрешает-
ся даже динамически менять эти сочетания.

   Среди других удобств UNIKBD назовем следующие.

   (а) Текущий регистр (РУС или ЛАТ) может также, при желании, ин-
       дицироваться:

          - цветом границы (border,рамки) экрана CGA, EGA или VGA;
          - звуком (потрескиванием при нажатии русских букв).

   (б) Как уже говорилось, предусмотрена возможность работы с про-
       извольной национальной клавиатурой. Для этого  при  запуске
       пользователь должен указать файл,  описывающий  план нацио-
       нальной клавиатуры.  Кроме того,  ценой небольшого дополни-
       тельного расхода памяти (110 байтов) вы можете организовать
       работу еще с одной (альтернативной) клавиатурой, по умолча-
       нию состоящей из псевдографики и некоторых других символов.
       Она может быть полезна  также  при  работе  с  двумя нацио-
       нальными клавиатурами, например, русской и украинской (гру-
       зинской, эстонской и т.д.).  План альтернативной клавиатуры
       описывается в том же файле.

   (в) При вводе русского текста  знаки препинания  можно вводить,
       не нажимая клавишу Shift (так же, как на пишущей машинке).

   (г) Пользователь может выяснить и/или установить нужный регистр
       (РУС/ЛАТ) в своей программе или в пакете ДОС.

   (д) Драйвер умеет при  запуске,  если  надо,  сбрасывать  режим
       NumLock и ускорять работу клавиатуры.

   3. Программа UniScr позволяют загрузить любой шрифт, импонирую-
щий пользователю. Используя один из редакторов  шрифтов  (EVAFont,
FontEdit и др.), Вы можете скорректировать или создать оптимальный
(для себя) шрифт в виде файла и затем загружать его  в  нужный мо-
мент с помощью UniScr. Более того, можно динамически перезагрузить
шрифт, т.е. заменить текущий шрифт экрана на иной  (размер свобод-
ной памяти при этом не изменяется). Можно также отменить загружен-
ный шрифт и позже восстановить его простым нажатием клавиш. Понра-
вившийся Вам шрифт можно встроить в текст программы,  чтобы он за-
гружался по умолчанию.

   Практический пример: требуется выполнить программу, которая ве-
дет диалог, используя болгарскую или основную кодировку кириллицы.
Для  этого  вы  должны  загрузить соответствующий шрифт, запустить
программу, а затем восстановить обычный шрифт.

   Стандартные шрифты обеспечивают русские буквы максимально круп-
ного размера для соответствующего типа экрана.

   4. Программы системы занимают минимум памяти  (7-11 Кб).  Любая
из них может быть отключена и затем вновь активирована. При отклю-
чении можно освободить занимаемую ими память.

   Автор благодарен Л.З.Альперовичу, А.А.Березкину,  Л.И.Блехеру и
В.В.Семыкину за ценные советы и содействие в обкатке новых версий.


   Разрешается свободное  распространение и  использование системы
UNI в некоммерческих целях и в неизмененном виде. Разрешается так-
же по согласованию с разработчиком  доработка системы при условии,
что текст и  описание всех модификаций  предоставляются; авторские
права за авторами доработок признаются без ограничений.

   Тел. для справок:   591-93-09 дом.
   Замечания,  предложения  и взносы благодарных пользователей  (в
натуре, в деньгах или на худой конец в рублях) можно  присылать по
адресу:

      143013 Московская обл., Одинцовский район, пос.Немчиновка-1
      ул. Агрохимиков дом 7 кв. 100  Буничу Л.Г.

                      ┌──────────────────┐
                      │ Программа UNIKBD │
                      └──────────────────┘

   Драйвер запускается командой:

        UNIKBD [режимы]

и становится резидентным.

   Требуемая память: около 1000 байтов (без альтернативной клавиа-
туры) или 1150 байтов (с альтернативной клавиатурой).

   Если не задано иное, для установки  русского  регистра  следует
нажать и отпустить клавишу "правый Shift";  на  латинский  регистр
аналогично переключает "левый Shift".  Лишнее  нажатие  безвредно.
Сведения о распределении некоторых символов по клавишам  приведены
в приложении 1.

   Допустимые режимы:

   /?       вывод краткой подсказки и текущих режимов драйвера

   /A       активация UniKbd (ранее деактивированного режимом /D)

   /D       деактивация UniKbd (память не освобождается).
            При первом запуске UniKbd этот параметр игнорируется.

   /CL      сбросить режимы NumLock/CAPS/ScrollLock
            (только на расширенной клавиатуре)

   /F       ускорить работу клавиатуры при повторении символов
            (только на расширенной клавиатуре)

   /IB      индикация  текущего  регистра  цветом  границы  экрана
            (только в присутствии UNISCR):

              - черная рамка означает латинский регистр
              - зеленая рамка означает русский регистр
              - синяя рамка означает альтернативную клавиатуру

   /IBцвета аналогично, но  вместо  стандартных  цветов  будут ис-
            пользоваться цвета  с  указанными  десятичными  кодами
            (0-15). Первый код относится к  национальной клавиату-
            ре, второй - к альтернативной (если она не использует-
            ся, то задавать второй код не надо).  Коды разделяются
            запятой или черточкой, например: /IB1,6 . Список кодов
            цветов см. в приложении 3. Пример: /IB1 означает синий
            цвет.

   /IS      индикация текущего  регистра  с  помощью  звука:  ввод
            русских букв сопровождается негромким звуком.

   /K:коды  описание нестандартных клавиш  установки регистра букв
            (вместо левого и правого Shift). <Коды> - описание од-
            ного или двух сочетаний клавиш. См. Приложение 2.

   /KA      нужна альтернативная клавиатура.

   /KA:код  то же плюс описание нестандартных клавиш  для переклю-
            чения на альтернативную клавиатуру, см. ниже.

   /KS:код  описание нестандартных клавиш для запроса к  UniScr  с
            целью отмены и восстановления пользовательского шрифта
            экрана.

   /M:файл  загрузить нестандартный план  национальной клавиатуры.
            См. Приложение 1.

   /B       создать новый программный файл UNIKBD.COM,  в  который
            нестандартный план клавиатуры или нестандартные клави-
            ши встраиваются как стандартные. Режим  /B указывается
            совместно с режимами  /M, /K или /KS.  Файл UNIKBD.COM
            создается в текущем оглавлении;  если  там был  старый
            файл с тем же именем, он заменяется на новый.

   /R       реверсирование  верхнего ряда клавиш  в режиме NumLock
            (см. ниже).

   /SC      установить сразу  русский регистр.  Этот режим полезен
            перед запуском  программы,  работающей  с  кириллицей.
            Нельзя указывать режимы /SC и /B одновременно.

   /SL      аналогично, установить латинский регистр.

   /ST:имп  установить значение таймаута для одиночной клавиши пе-
            реключения регистра (см. ниже).

   /U       завершение  UniKbd  (память освобождается).
              Предостережение:  попытка удалить  UniKbd  с помощью
            режима /U может привести к зависанию, если  после него
            запускался другой драйвер,  перехватывающий прерывания
            9 или 16h.  Завершать драйверы следует строго в поряд-
            ке, обратном порядку запуска.  Зависание возможно  и в
            том случае,  когда редакции завершаемого и запущенного
            драйверов не совпадают.


   Замечания и разъяснения
   -----------------------
   1. Параметры программ набираются строчными или  заглавными бук-
вами.  Перед "/"  могут быть пробелы (но могут и не быть).  Вместо
косой черты допускается черточка: "-",  но тогда пробелы перед ней
обязательны.

   2. Можно указать несколько параметров одновременно, например:

        unikbd /r/ib2  /m:unimain.kbd

   Порядок параметров не играет роли. Исключение -  параметры /? и
/U, которые не должны использоваться совместно с  другими парамет-
рами.

   3. Программа работает совместно с UniScr  или отдельно от него,
на любой ПЭВМ типа IBM PC.

   4. Если Вы случайно нажали на Shift и не хотите,  чтобы  он пе-
реключил регистр, подождите около секунды  и только тогда отожмите
Shift. В этом случае нажатие будет проигнорировано ("таймаут"). То
же верно и для других "одиночных" клавиш, определенных  режимом /K
(но сочетание двух или трех клавиш срабатывает сразу).

   Режим /ST:имп  позволяет управлять  значением  таймаута.  В нем
указывается интервал времени,  сверх которого драйвер  не согласен
ждать отжатия клавиши.  Время задается  в импульсах таймера  ("ти-
ках"), одна секунда - это примерно 18 импульсов. По умолчанию под-
разумевается режим /ST:18 (одна секунда); значение /ST должно быть
в интервале от 1 до 255.

   5. Стандартная клавиатура кириллицы имеет одно существенное не-
удобство: при вводе знаков препинания (точки, запятой и др.) необ-
ходимо каждый раз нажимать Shift.  Режим  /R  ликвидирует это неу-
добство следующим образом.  Если вы указали этот режим при запуске
UniKbd, то клавиша NumLock переключает значения не только  на циф-
ровой клавиатуре, но и верхнем ряду. Другими словами, знаки препи-
нания в режиме NumLock вводятся без помощи Shift,  а цифры, наобо-
рот, через Shift или с цифровой клавиатуры. Это особенно удобно на
расширенной клавиатуре (101-102 клавиши).  На латинском регистре и
при отключенном NumLock все вводится как обычно.

   Более радикальное решение этой проблемы -  использование  плана
клавиатуры UNIKALT.REV,  устроенного по образцу клавиатуры пишущей
машинки (см. приложение 1).

   6. Если обе программы (UniKbd и UniScr) запущены,  одно сочета-
ние клавиш воспринимается как  переключатель  загруженного  шрифта
экрана. По умолчанию это комбинация  Ctrl+Alt+правый Shift. Первое
нажатие означает временную отмену загруженного  шрифта (устанавли-
вается стандартный шрифт ЭВМ, встроенный в  аппаратуру); следующее
нажатие восстанавливает загруженный шрифт и т.д.  Эта  возможность
доступна только в текстовых режимах (видеорежимы 0-3).

   Режим /KS:клавиши  позволяет задать другое сочетание клавиш для
этой цели. О кодировке клавиш см. Приложение 2.

   7. Режим /KA позволяет пользователю работать с  двумя клавиату-
рами: национальной и альтернативной. Эта возможность введена в ос-
новном для удобства ввода символов псевдографики  внутри программ,
не содержащих средств разлиновки. Можно использовать ее и в других
целях,  например, для ввода текста, содержащего специальные знаки,
или для работы с двумя различными национальными клавиатурами.

   Чтобы переключиться на альтернативную клавиатуру,  надо  нажать
символы  Ctrl+Alt+левый Shift  (режим /KA:код  позволяет описать и
другое сочетание клавиш для этой цели). После этого латинские бук-
вы вводятся как обычно, а вместо русских букв  вводится псевдогра-
фика.  Стандартный план клавиатуры  см. в Приложении 1.  Повторное
нажатие Ctrl+Alt+левый Shift восстанавливает  национальную клавиа-
туру.

   8. Повторный запуск UniKbd безопасен и может  быть  использован
для выяснения или модификации текущих параметров драйвера: актива-
ции/деактивации, изменения цвета рамки экрана,  установки регистра
РУС/ЛАТ, перенастройки клавиш, завершения работы и т.д. Однако ре-
жимы /B и /M можно задать лишь при ПЕРВОМ запуске  (при  повторном
они игнорируются). Режим /KA:код можно задавать при  повторном за-
пуске, если при первом запуске задавался режим /KA или /KA:код.

   Для отмены режимов /F, /IB, /IS, /R надо  указать соответствен-
но: /F-, /IB-, /IS-, /R-  (при этом режим /R- действует только при
погашенном NumLock, иначе он будет отвергнут).

   9. UniKbd реализует три дополнительные функции  прерывания 16h,
обращение к которым имеет вид:

        mov  AX,02<nn>h
        mov  BX,"LG"
        int  16h

   Здесь <nn> - две шестнадцатиричные цифры номера функции:

     nn=00 - выяснить присутствие UniKbd и состояние клавиатуры
             Результаты:  AX=0FFFFh (признак наличия UniKbd)
                          ES=значение CS драйвера
                          BH=флажки состояния:

               бит 7 - опознан экран CGA (если бит=1), EGA/VGA (0)
               бит 6 - установлен регистр РУС (1), ЛАТ (0)
               бит 5 - действует режим /IB  (1)
               бит 4 - действует режим /R   (1)
               бит 3 - действует режим /IS  (1)
               бит 2 - UniKbd деактивирован (1)
               бит 1 - два сочетания клавиш (1), одно (0)
               бит 0 - действует альтернативная клавиатура (1)

     nn=01 - установить регистр ввода РУС (кириллица)
     nn=02 - установить регистр ввода ЛАТ (латиница)

   Деактивация UniKbd (режим /D) не мешает использованию функций 1
и 2, хотя их действие откладывается до момента активации драйвера.
Рамка экрана, впрочем, корректируется (если действует режим /IB).

   10. Некоторые программы  (например,  Norton Commander,  FoxPro,
Ventura Publisher и др.) отвергают русскую букву  "р".  Не  верьте
сообщениям о том, что есть драйверы кириллицы,  позволяющие испра-
вить этот недостаток; эти драйверы просто  жульнически подставляют
вместо русской буквы "р" латинскую "p". Такая  подстановка  опасна
и, вообще говоря,  не может быть рекомендована.  Лучше  доработать
сами программы;  для Norton Commander 3.0, например, достаточно по
адресу 1E02 заменить байт E0 на 00.

                      ┌──────────────────┐
                      │ Программа UNISCR │
                      └──────────────────┘


   Драйвер запускается командой:

      UNISCR [режимы]

и становится резидентным. Требуемая память: 6.5K  (EGA)  или 10.5К
(VGA).

   Если пользователь  не указал иное,  программа использует  стан-
дартные шрифты (8*8, 8x14 или 8*16). Поддерживается  кириллица  во
всех текстовых и графических видеорежимах EGA и VGA, а также в до-
полнительных видеорежимах 40-53h, которые считаются текстовыми.

   Список допустимых режимов:

   /?        вывод подсказки

   /B        создать новый программный файл UNISCR.COM,  в котором
             указанные шрифты будут встроены как стандартные. Файл
             создается в текущем оглавлении; если там  был  старый
             файл с тем же именем, он заменяется на новый.

   /C        улучшает работу программы на ЭВМ с не  вполне совмес-
             тимыми BIOS или картами EGA/VGA.

   /D        деактивация UniScr (память не освобождается)
   /A        активация драйвера (ранее деактивированного)

   /F:файлы  загрузка нестандартных шрифтов  8*8,  8*14  или 8*16.
             Можно указать от одной до трех спецификаций файлов со
             шрифтами, разделяемых пробелами или запятой.

   /U        завершение  UniScr  (память освобождается).
               Предостережение: попытка удалить UniScr  с  помощью
             режима /U может привести к зависанию, если после него
             запускался другой драйвер, перехватывающий прерывание
             10h. Завершать драйверы следует строго в порядке, об-
             ратном порядку запуска.  Зависание возможно  и  в том
             случае,  когда  редакции  завершаемого  и запущенного
             драйверов не совпадают.


   Замечания и разъяснения
   -----------------------
   1. Параметры программы набираются строчными или заглавными бук-
вами. Перед "/" могут быть пробелы (но могут и  не  быть).  Вместо
косой черты допускается черточка: "-",  но тогда пробелы перед ней
обязательны. Вместо двоеточия допускается знак равенства: "=".
   Например, следующие два примера эквивалентны:

        uniscr/f=uni.f16  thinus.f8
        uniscr -f:uni.f16,thinus.f8

   2. Можно указать несколько параметров одновременно, например:

        uniscr /b /f:d:\fonts\elite8.alt d:\fonts\myfont14 /c

   Порядок параметров не играет роли. Исключение -  параметры /? и
/U, которые не должны использоваться совместно с  другими парамет-
рами.

   3. Повторный запуск драйвера безопасен и может быть использован
для модификации его параметров (режимы /F и /С), записи нового ва-
рианта программы (режим /B), временной деактивации  (режимы  /D  и
/A) или завершения его работы (режим /U). Для отмены режима /C на-
до указать режим:  /C- .

   4. Для файлов со шрифтами можно указать пути доступа к ним (см.
пример выше);  каждая спецификация файла должна содержать не более
60 символов.  Структура файла обычная  и соответствует формату ре-
дакторов шрифтов EVAFONT, FONTEDIT, DOTEDIT, FNT и др.
   Длина файла зависит от высоты шрифта:

       2048  для шрифта 8*8
       3584  для шрифта 8*14
       4096  для шрифта 8*16

   UniScr автоматически определяет тип (высоту) шрифта, ориентиру-
ясь по длине файла.  Если длина не совпадает с приведенными значе-
ниями, файл отвергается.

   Для совместимости с предыдущими редакциями UniScr  поддерживаю-
тся режимы:

       /14:файл         /16:файл         /8:файл

   Все они эквивалентны режиму /F.

   Внимание: некоторые файлы шрифтов распространяются в формате "с
заголовком", т.е. их длина больше, чем указано выше,  на  величину
добавленного (обычно спереди) заголовка.  Прежде чем  использовать
такие шрифты, надо удалить заголовок.

   5. В комплект поставки входит набор  разнообразных  шрифтов,  в
том числе:

      UNI.F8   - стандартный шрифт 8*8
      UNIM.F8  -     крупный шрифт 8*8 для VGA
      UNI.F14  - стандартный шрифт 8*14
      UNIM.F16 - стандартный шрифт 8*16
      UNI.F16  - более мелкий шрифт 8*16, удобен для графики

   6. Разумеется, загружать можно не только шрифты  с  кириллицей,
но и любые другие.  Поэтому  все сообщения,  кроме заставки и под-
сказки, программа выдает на английском языке. Для не-русских алфа-
витов несложно сгенерировать чисто англоязычные  или  национальные
варианты UNI-драйверов.

   7. UniScr реализует три дополнительные функции  прерывания 10h,
обращение к которым имеет вид:

        mov  AH,0Fh
        mov  BX,"LG"
        mov  CX,"B<n>"
        int  10h

   Здесь <n> - номер функции:

     n=0 - выяснить присутствие UniScr
           Результаты:  AX=0FFFFh (признак наличия UniScr)
                        BX=значение CS драйвера

     n=1 - установить заводской шрифт экрана  (т.е. временно отме-
           нить шрифт пользователя)

     n=2 - восстановить загруженный шрифт пользователя

                                           П р и л о ж е н и е   1

                  П л а н   к л а в и а т у р ы

   Стандартное распределение букв по клавишам  в основном соответ-
ствует русской клавиатуре для пишущих машинок.  Буква "е"" отсутст-
вует, твердый знак есть.

   При работе с альтернативной  клавиатурой  вместо  русских  букв
вводится псевдографика.  Соответствие  клавиш  можно определить  в
файле плана клавиатуры (см. ниже),  по умолчанию используется план
Д.А.Гуртяка (драйвер KEYRUS).

   Верхний ряд клавиш надо маркировать следующим образом:

   ┌─────┬───┬─────┬─────┬─────┬─────┬─────┬─────┬───┬───┬───┐
   │ ~   │ ! │ @ " │ # ' │ $ ; │ % : │ ^ , │ & . │ * │ ( │ ) │
   │ ` % │ 1 │  2  │  3  │  4  │  5  │  6  │  7  │ 8 │ 9 │ 0 │
   └─────┴───┴─────┴─────┴─────┴─────┴─────┴─────┴───┴───┴───┘

   Здесь левый символ из двух указанных  наверху  вводится  на ла-
тинском регистре, правый - на русском.  Напомним, что в режиме  /R
клавиша NumLock переключает значения десяти клавиш с цифрами. Сим-
вол процента предусмотрен на клавише с тильдой (~), нижний регистр
кириллицы.

   Нетрудно убедиться, что все знаки препинания на регистре кирил-
лицы доступны,  переходить на латиницу придется  только для знаков
"<" и ">", а также при вводе редких в русском тексте символов:

    `  @  #  $  ^  &  [  ]  {  }

   Остальные ряды клавиш устроены следующим образом.

   1. Стандартный план нижнего регистра (при отжатом Shift)
 ───────────────────────┬─────────────────────┬───────────────────
 q w e r t y u i o p [ ]│a s d f g h j k l ; '│z x c v b n m , . /
 й ц у к е н г ш щ з х ъ│ф ы в а п р о л д ж э│я ч с м и т ь б ю /
 ┌ ┬ ┐ ╓ ╥ ╖ │ ─ ║ ═ [ ]│├ ┼ ┤ ╟ ╫ ╢ ░ ▒ ▓ ; '│└ ┴ ┘ ╙ ╨ ╜ √ , . /
 ───────────────────────┴─────────────────────┴───────────────────

   2. Стандартный план верхнего регистра (при нажатом Shift)
 ───────────────────────┬─────────────────────┬───────────────────
 Q W E R T Y U I O P { }│A S D F G H J K L : "│Z X C V B N M < > ?
 Й Ц У К Е Н Г Ш Щ З Х Ъ│Ф Ы В А П Р О Л Д Ж Э│Я Ч С М И Т Ь Б Ю ?
 ╔ ╦ ╗ ╒ ╤ ╕ █ ▄ ▌ ▐ { }│╠ ╬ ╣ ╞ ╪ ╡ ▀ ■ ¤ : "│╚ ╩ ╝ ╘ ╧ ╛ № < > ?
 ───────────────────────┴─────────────────────┴───────────────────

   Здесь первые строки относятся к латинскому регистру, вторые - к
русскому, третьи - к альтернативной клавиатуре.

   Режим /M позволяет описать нестандартные планы  национальной  и
альтернативной клавиатур. Это должен быть файл длиной 106  или 212
байтов.

   При длине 106 байтов он описывает только национальную клавиату-
ру и содержит ASCII-коды клавиш со скэн-кодами от 1 до  53. Первая
половина файла описывает клавиши  нижнего  регистра  (при  отжатом
Shift), вторая - верхнего (при нажатом).

   При длине 212 байтов он содержит также  и  план  альтернативной
клавиатуры,  расположенный после национальной  и устроенный  точно
так же.

   Примеры:

     - файл UNIKALT.STD,  соответствующий стандартной клавиатуре в
альтернативной кодировке (принят по умолчанию);

     - файл UNIKALT.REV,  отличающийся  от  UNIKALT.STD  реверсным
расположением верхнего ряда клавиш (в режиме кириллицы).

------------------------------------------------------------------
                                           П р и л о ж е н и е   2

  О п р е д е л е н и е   н е с т а н д а р т н ы х   к л а в и ш

   Параметр /K может быть задан двумя способами:

      /K:рус,лат
      /K:переключатель

   В первом случае описываются два сочетания  клавиш  (разделенные
запятой или черточкой): первое устанавливает русский регистр, вто-
рое - латинский.
   Во втором случае используется одно сочетание клавиш:  при  пер-
вом нажатии оно устанавливает кириллицу,  при следующем - латиницу
и т.д.
   В параметрах /KA и /KS может быть задано только  одно сочетание
(т.е. допускается лишь второй способ).

   Каждое сочетание клавиш задается одним из трех вариантов.

      (1) Десятичный скэн-код клавиши (см. таблицу 1).
      (2) Один или несколько (до трех) кодов специальных клавиш:

           A - клавиша Alt (любая)       LA - левая  клавиша Alt
           C - клавиша Ctrl (любая)      RA - правая клавиша Alt
          LS - клавиша левый Shift       LC - левая  клавиша Ctrl
          RS - клавиша правый Shift      RC - правая клавиша Ctrl

          Коды LA, RA, LC, RC допускаются  ТОЛЬКО  для расширенной
          клавиатуры (101-102 клавиши).

      (3) Один или два кода специальных клавиш, за которыми следу-
          ет (вплотную) скэн-код дополнительной клавиши.

   Примеры.

      /K:54,42     - значение по умолчанию (можно и так: /K:RS,LS)
      /K:RC,LC     - правый Ctrl (РУС), левый Ctrl (ЛАТ)
      /K:70        - клавиша ScrollLock
      /K:C87-C88   - сочетания Ctrl+F11 (РУС) и Ctrl+F12 (ЛАТ)
      /K:RARS,LALS - сочетания  правый Alt + правый Shift (РУС)
                                и левый Alt + левый Shift (ЛАТ)
      /K:RCRA      - переключатель:  правый Ctrl + правый Alt
      /KS:LSRS     - левый и правый Shift одновременно

   Замечания.

   1. Если задано сочетание двух или трех клавиш, порядок их нажа-
тия не играет роли. Если задана одна клавиша, то, чтобы она срабо-
тала, надо ее нажать и тут же отжать;  при этом не должны быть на-
жаты посторонние клавиши (Ctrl, Alt и др.), иначе переключение от-
меняется.

   2. Описанное вами сочетание клавиш после обработки в UniKbd пе-
редается вышестоящему обработчику (BIOS или другому драйверу). По-
этому не следует включать в него текстовые  символы  и  сочетания,
обрабатываемые другими программами или  MS-DOS  (например,  буквы,
функциональные клавиши, CAPS LOCK).

   Не следует указывать в сочетаниях среди прочих клавишу NumLock,
если предполагается использовать режим /R.

   3. Можно реализовать  довольно  изощренные  способы  управления
клавиатурой,  если комбинировать скэн-коды нажатия  и отжатия кла-
виш. Напомню, что последние получаются из первых прибавлением 128.
Пример: /K:A170; в этом случае переключение регистра букв произой-
дет при выполнении следующих действий:

         нажать левый Shift;  нажать Alt;  отжать левый Shift;
   или:  нажать и отжать левый Shift; нажать Alt.

   В обоих случаях  получается  заказанное  сочетание  Alt+отжатие
LShift (в разном порядке). Однако необходима осторожность: это со-
четание может получиться  и  в других  ситуациях,  например:

   ввести заглавную букву и отжать Shift;  ввести Alt + что-нибудь

              С к э н - к о д ы   к л а в и ш            Таблица 1

┌───────┬──────┐     ┌───────┬──────┐     ┌───────┬──────┐
│ Кла-  │ Скэн-│     │ Кла-  │ Скэн-│     │ Кла-  │ Скэн-│
│ виша  │  код │     │ виша  │  код │     │ виша  │  код │
└───────┴──────┘     └───────┴──────┘     └───────┴──────┘
   ESC      1            A      30          F1        59
    1       2            S      31          F2        60
    2       3            D      32          F3        61
    3       4            F      33          F4        62
    4       5            G      34          F5        63
    5       6            H      35          F6        64
    6       7            J      36          F7        65
    7       8            K      37          F8        66
    8       9            L      38          F9        67
    9      10            ;      39          F10       68
    0      11            '      40        NumLock     69
    -      12            `      41       ScrollLock   70
    =      13       Левый Shift 42          Home      71
BackSpace  14            \      43           Up       72
   Tab     15            Z      44          PgUp      73
    Q      16            X      45         Серый -    74
    W      17            C      46          Left      75
    E      18            V      47         Center     76
    R      19            B      48         Right      77
    T      20            N      49         Серый +    78
    Y      21            M      50          End       79
    U      22            ,      51          Down      80
    I      23            .      52          PgDn      81
    O      24            /      53          Ins       82
    P      25      Правый Shift 54          Del       83
    [      26        Серая *    55     ░░░░░░░░░░░░░░░░░░░
    ]      27          Alt      56     ░ Alt-PrtSc    84 ░ только
  Enter    28        Пробел     57     ░    F11       87 ░ расшир.
  Ctrl     29       CapsLock    58     ░    F12       88 ░ клав-ра


------------------------------------------------------------------
                                           П р и л о ж е н и е   3

               К о д ы   ц в е т о в   э к р а н а

        0      Черный                 8    Серый
        1      Синий                  9    Ярко-синий
        2      Зеленый               10    Ярко-зеленый
        3      Голубой               11    Ярко-голубой
        4      Красный               12    Ярко-красный
        5      Сиреневый             13    Ярко-сиреневый
        6      Коричневый            14    Желтый
        7      Белый                 15    Ярко-белый

                                           П р и л о ж е н и е   4

               П р о т о к о л   и з м е н е н и й

 UNIKBD (3.1)    Если определена ТОЛЬКО ОДНА клавиша установки или
               переключения регистра ЛАТ/РУС, а не  сочетание кла-
               виш, то нажатие ее дольше секунды  или одновременно
               с другими клавишами (например, Shift вместе  с Ctrl
               или Alt) не переключает регистр.
                 Рамка экрана не пропадает ни при каком переключе-
               нии видеорежима.
                 Режим /B, аналогично UniScr, генерирует новый эк-
               земпляр UNIKBD.COM, в который встроен нестандартный
               план клавиатуры и/или нестандартные клавиши.

        (3.2)    Обеспечен ввод русской буквы "р" на некоторых ЭВМ
               с особо глупыми BIOS.

        (3.3)    При первом запуске  (а также  в каждой подсказке)
               указываются текущие клавиши смены регистра и шрифта
               экрана.
                 Режим /B можно задавать и без режима /M.
                 Операнды в параметре /K можно разделять не только
               запятой, но и черточкой. Это  позволяет  передавать
               их как параметры в BAT-файл (MS-DOS запрещает запя-
               тые в тексте параметров пакета).

        (3.4)    Добавлен режим /CL (сброс NumLock).
                 Исправлена ошибка,  из-за  которой  в присутствии
               UniKbd  не работала  функция  ускорения  клавиатуры
               (например, команда  MODE CON rate=... ).

        (4.0)    Обеспечена работа  с  альтернативной  клавиатурой
               (обычно это символы псевдографики).  В связи с этим
               добавлены режим /KA  для описания клавиш переключе-
               ния клавиатур и второй цвет рамки в /IB.
                 Можно сгенерировать  мини-вариант (880 байтов)  и
               чисто англоязычный вариант (в  стандартную поставку
               не включены).
                 Добавлены режимы /F и /F- (ускорение клавиатуры).
                 Исправлена ошибка, не позволявшая задавать  в ре-
               жиме /KS сочетание более чем из двух клавиш.
                 Уточнен алгоритм обработки  сочетаний клавиш вида
               Shift + что-то. Например, если определено /K:LSLC и
               при этом нажат NumLock,  то регистр переключался не
               только при нажатии описанных клавиш, но также и при
               нажатии  Ctrl + серые стрелки.  Дело в том,  что на
               расширенной клавиатуре  перед кодами  серых стрелок
               (при нажатом NumLock) выводятся коды E0 + LS, что и
               вызывало ложное срабатывание. Теперь все в порядке.
                 Для экономии памяти освобождается область окруже-
               ния MS-DOS.
                 Усилен   синтаксический   контроль    параметров:
               раньше, например, слово, перед которым не было "/",
               игнорировалось. Допускается "-" вместо "/".
                 Улучшен внешний вид протокола работы.

        (4.1)    Специальное обслуживание символа F0h  (Ё, ЙО заг-
               лавное).
                 Символ с ASCII-кодом 224 (обычно это русская бук-
               ва "р")  теперь не привязан к клавише со скэн-кодом
               23h и может быть назначен любой клавише.
                 Добавлен режим /ST  для управления таймаутом оди-
               ночной клавиши переключения регистра.


 UNISCR (2.3)    Объединены UNIEGA и UNIVGA.
                 Проверена работа  с  WORD  5.5  для разного числа
               строк на экране, исправлена ошибка.

        (2.4)    Новые режимы: /D и /A (динамическая активация).
                 Исправлены две ошибки, вкравшиеся при оптимизации
               драйвера редакции 2.2:

                   - режим /B работал лишь при первом запуске;
                   - в режимах 11-12h (VGA) счетчик  строк  вместо
                     правильного числа 30  (или  60)  указывал  25
                     (или 50).  Это  вызывало  вертикальный  сдвиг
                     текстовых строк на графической картинке.

        (2.5)    Режимы /8, /14 и /16 объединены в одном режиме /F
               (хотя старые режимы тоже поддерживаются).
                 Включен контроль длины файлов со шрифтами  - зна-
               чения, не равные 2048, 3584 или 4096,  отвергаются.
               Выводится протокол загрузки шрифтов.
                 Можно сгенерировать чисто англоязычный вариант (в
               стандартную поставку не включен).
                 Для экономии памяти освобождается область окруже-
               ния MS-DOS.
                 Ужесточен синтаксический контроль параметров, как
               для UniKbd. Допускается "-" вместо "/", а также "="
               вместо ":".
                 Исправлена ошибка, из-за которой иногда портилась
               форма курсора при переходе от графического режима к
               текстовому, а также при  нажатии  в  UniKbd  клавиш
               восстановления пользовательского шрифта.
                 Для функции 11h прерывания 10h теперь обрабатыва-
               ются подфункции со следующими номерами:

                     1, 2, 4, 11h, 12h, 14h, 22-24h, 30h

        (2.5a)   Уточнены алгоритмы установки видеорежима, обеспе-
              чена работа с некоторыми необычными BIOS.  Режим  /C
              фактически игнорируется; пока что в нем нет нужды.
